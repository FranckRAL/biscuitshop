{% load static %}
{% load cloudinary %}
{% load cloudinary_filters %}

{% if product %}
    <article class="flex flex-col md:flex-row min-h-[400px] max-h-[90vh] overflow-y-auto md:overflow-hidden bg-white">
        <div class="relative w-full md:w-1/2 h-full md:h-auto overflow-hidden bg-amber-50">
            <img src="{{product.image.url|optimize_biscuits:'medium'}}" alt="{{product.name}}" 
                 class="h-full w-full object-cover transition-transform duration-1000 hover:scale-110" 
                 loading="lazy" />
            
            <button
                class="favorite-btn absolute top-6 right-6 bg-white/90 backdrop-blur-md p-3 rounded-full shadow-lg hover:bg-white transition-all active:scale-90"
                data-url="{% url 'toggle-favorite' product.id %}"
                data-product-id="{{ product.id }}">
                {% if product.id in request.wishlist %}
                <i class="bi bi-heart-fill text-red-500 text-xl"></i>
                {% else %}
                <i class="bi bi-heart text-amber-900 text-xl"></i>
                {% endif %}
            </button>

            <button id="close-modal" 
                    class="absolute top-6 left-6 bg-amber-900/10 hover:bg-amber-900/20 p-2 rounded-full transition-colors md:hidden">
                <i class="bi bi-x-lg text-amber-900"></i>
            </button>
        </div>

        <div class="w-full md:w-1/2 p-8 md:p-12 flex flex-col justify-center relative">
            
            <button onclick="document.getElementById('product-details-modal').close()" 
                    class="absolute top-8 right-8 text-amber-900/20 hover:text-amber-600 transition-colors hidden md:block">
                <i class="bi bi-x-lg text-2xl"></i>
            </button>

            <div class="mb-6">
                <span class="inline-block bg-amber-100 text-amber-800 text-[10px] font-black px-3 py-1 rounded-full uppercase tracking-widest mb-4">
                    Artisanal Biscuit
                </span>
                <h1 class="text-3xl sm:text-4xl font-black text-amber-900 mb-3 leading-tight italic">
                    {{ product.name }}
                </h1>
                <div class="flex items-center gap-3">
                    <div class="flex text-amber-400 text-sm">
                        <i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i><i class="bi bi-star-half"></i>
                    </div>
                    <span class="text-amber-800/40 text-[10px] font-bold uppercase tracking-tighter">Verified Quality</span>
                </div>
            </div>

            <p class="text-amber-800/70 text-base leading-relaxed mb-8 border-l-4 border-amber-200 pl-4 italic line-clamp-4 md:line-clamp-none">
                {{ product.description }}
            </p>
            
            <div class="flex flex-wrap items-center justify-between gap-6 mb-8">
                <div>
                    <span class="block text-[10px] font-black text-amber-900/30 uppercase mb-1">Price</span>
                    <p class="text-4xl font-black text-amber-600">
                        <span class="text-lg font-medium text-amber-800/50 mr-1">Ar</span>{{ product.price }}
                    </p>
                </div>
                
                <div class="flex items-center border-2 border-amber-100 rounded-2xl overflow-hidden bg-white shadow-sm">
                    <button class="px-4 py-2 text-amber-900 hover:bg-amber-50 font-bold">-</button>
                    <span class="px-5 py-2 font-black text-amber-900 bg-amber-50/30">1</span>
                    <button class="px-4 py-2 text-amber-900 hover:bg-amber-50 font-bold">+</button>
                </div>
            </div>

            <div class="flex flex-col gap-4">
                <button
                    class="add-cart-btn w-full bg-amber-600 hover:bg-amber-700 text-white font-black py-4 rounded-2xl flex items-center justify-center gap-3 transition-all shadow-xl shadow-amber-200 active:scale-95 group"
                    data-url="{% url 'add-to-cart' product.id %}">
                    <i class="bi bi-cart-plus text-xl group-hover:rotate-12 transition-transform"></i>
                    <span class="uppercase tracking-widest text-sm">Ajouter au panier</span>
                </button>
                
                <p class="text-[9px] text-center text-amber-900/30 font-bold uppercase tracking-widest">
                    <i class="bi bi-shield-check"></i> Secure payment available
                </p>
            </div>
        </div>
    </article>

<script src="{% static 'js/utils.js' %}"></script>
<script src="{% static 'js/products.js' %}"></script>
{% endif %}